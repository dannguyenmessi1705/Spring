# Sử dụng JPA, Hibernate, JDBC, H2 Database trong SpringBoot
## 1. H2 Database
H2 Database là một cơ sở dữ liệu in-memory, hỗ trợ phát triển ứng dụng SpringBoot mà không cần cấu hình cơ sở dữ liệu.

Để sử dụng H2 Database trong ứng dụng SpringBoot, chúng ta cần thêm các library như `H2 Database`, `Spring Data JPA`, `Spring Data JDBC`

### 1.1. Cấu hình cho phép truy cập vào H2 Database từ URL
Để cho phép truy cập vào H2 Database từ URL, chúng ta cần cấu hình trong file `application.properties` hoặc `application.yml`.

Mặc định đường dẫn truy cập vào H2 Database là `http://localhost:8080/h2-console`.

Khi truy cập vào đường dẫn này, chúng ta cần có đường dẫn JDBC URL của H2 Database. Đường dẫn này sẽ được hiển thị trong console khi chúng ta chạy ứng dụng SpringBoot. Ngoài ra ta có thể tùy chỉnh đường dẫn JDBC URL trong file `application.properties` hoặc `application.yml` với prefix là `jdbc:h2:mem:`.

Ví dụ:
```properties
# Chỉ cho phép truy cập vào H2 Database từ URL
spring.h2.console.enabled=true 
# Đường dẫn JDBC URL của H2 Database
spring.datasource.url=jdbc:h2:mem:testdb
```

### 1.2. Tạo schema khi ứng dụng SpringBoot khởi chạy
Để tạo schema khi ứng dụng SpringBoot khởi chạy, chúng ta cần thêm file `schema.sql` hoặc `data.sql` vào thư mục `src/main/resources`.

File `schema.sql` sẽ chứa các câu lệnh SQL để tạo schema, còn file `data.sql` sẽ chứa các câu lệnh SQL để insert dữ liệu vào schema.

Sau khi chạy ứng dụng SpringBoot, các câu lệnh SQL trong file `schema.sql` và `data.sql` sẽ tự động được thực thi.

## 2. Sử dụng JDBC Template
Trong SpringBoot, chúng ta có thể sử dụng `JdbcTemplate` để thao tác với cơ sở dữ liệu thông qua JDBC.

JDBC Template cung cấp các phương thức để thực thi các câu lệnh SQL như:
- `query`: Thực thi câu lệnh SQL truy vấn dữ liệu từ cơ sở dữ liệu.
- `update`: Thực thi câu lệnh SQL thêm, sửa, xóa dữ liệu từ cơ sở dữ liệu.
- `batchUpdate`: Thực thi nhiều câu lệnh SQL cùng một lúc.
- `execute`: Thực thi câu lệnh SQL không trả về kết quả.
- `queryForObject`: Thực thi câu lệnh SQL truy vấn một dòng dữ liệu từ cơ sở dữ liệu.
- `queryForList`: Thực thi câu lệnh SQL truy vấn nhiều dòng dữ liệu từ cơ sở dữ liệu.
- `queryForMap`: Thực thi câu lệnh SQL truy vấn dữ liệu từ cơ sở dữ liệu và trả về dữ liệu dưới dạng Map.
- `queryForRowSet`: Thực thi câu lệnh SQL truy vấn dữ liệu từ cơ sở dữ liệu và trả về dữ liệu dưới dạng `SqlRowSet`.
- `queryForStream`: Thực thi câu lệnh SQL truy vấn dữ liệu từ cơ sở dữ liệu và trả về dữ liệu dưới dạng `Stream`.

Để sử dụng `JdbcTemplate`, chúng ta cần thêm dependency `spring-boot-starter-jdbc` vào file `pom.xml`.

### 2.1. Sử dung JdbcTemplate + H2 Database
Sau khi cấu hình H2 Database, chúng ta có thể sử dụng `JdbcTemplate` để thao tác với cơ sở dữ liệu H2 Database.

Ví dụ:
> JdbcTemplateExample.java
```java
package com.example.demo;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

@Repository
public class JdbcTemplateExample {

    @Autowired
    private JdbcTemplate jdbcTemplate; // Inject JdbcTemplate vào để thao tác với cơ sở dữ liệu

    private String INSERT_DATA = """
            INSERT INTO users (id, name) VALUES (1, 'John')
            """; // Câu lệnh SQL thêm dữ liệu vào bảng users, sử dung cú pháp mới của Java 13, ba dấu nháy kép dùng để viết chuỗi trên nhiều dòng, và String phải đặt trong dấu ngoặc đơn.

    public void createTable() {
        jdbcTemplate.execute("CREATE TABLE IF NOT EXISTS users (id INT, name VARCHAR(255))");
    }

    public void insertData() {
        jdbcTemplate.update("INSERT INTO users (id, name) VALUES (1, 'John')");
    }

    public void selectData() {
        jdbcTemplate.query("SELECT * FROM users", (rs, rowNum) -> {
            System.out.println(rs.getInt("id") + " " + rs.getString("name"));
            return null;
        });
    }
}
```

Trong ví dụ trên, chúng ta đã tạo một class `JdbcTemplateExample` để thao tác với cơ sở dữ liệu H2 Database thông qua `JdbcTemplate`.

Để sử dụng `JdbcTemplate`, chúng ta cần inject `JdbcTemplate` vào class và sử dụng các phương thức của `JdbcTemplate` để thao tác với cơ sở dữ liệu.

Ví dụ thực thi các câu lệnh dữ liệu ngay sau khi chạy ứng dụng SpringBoot:
> AppRunner.java
```java

package com.example.demo;

import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class AppRunner implements CommandLineRunner {

    private final JdbcTemplateExample jdbcTemplateExample;

    public AppRunner(JdbcTemplateExample jdbcTemplateExample) {
        this.jdbcTemplateExample = jdbcTemplateExample;
    }

    @Override
    public void run(String... args) throws Exception {
        jdbcTemplateExample.createTable();
        jdbcTemplateExample.insertData();
        jdbcTemplateExample.selectData();
    }
}
```
