# Sử dụng Unit Test và Mockito trong Spring Boot
## 1. Giới thiệu    
`Unit Test` là một loại kiểm thử phần mềm mà ở đó các đơn vị hoặc thành phần của phần mềm được kiểm tra một cách riêng lẻ. Mục tiêu của `Unit Test` là kiểm tra xem mỗi đơn vị hoặc thành phần của phần mềm hoạt động đúng như mong đợi hay không. `Unit Test` giúp đảm bảo rằng mã nguồn của bạn hoạt động đúng và không bị lỗi.

`Mockito` là một thư viện giúp chúng ta tạo ra các đối tượng giả mạo (mock object) để kiểm tra các phương thức của đối tượng đó. `Mockito` giúp chúng ta kiểm tra xem một phương thức được gọi hay không, số lần gọi, tham số truyền vào, giá trị trả về,...

## 2. Sử dụng Unit Test
Trong `Spring Boot`, chúng ta có thể sử dụng `JUnit` để viết các `Unit Test`.

`JUnit` là một framework giúp chúng ta viết các `Unit Test` một cách dễ dàng. `JUnit` giúp chúng ta kiểm tra xem một phương thức hoạt động đúng như mong đợi hay không. 

Ví dụ ta có 1 phươn thức `add` trong class `Calculator`. Junits giúp chúng ta kiểm tra xem phương thức `add` có hoạt động đúng như mong đợi hay không.

Chúng ta sử dụng `JUnit Jupiter`, phiên bản `JUnit 5` để viết các `Unit Test`.

> Lưu ý: Cần phải tạo `Source Folder` mới để chứa các `Unit Test`, không nên viết `Unit Test` trong `Source Folder` chứa mã nguồn.
> Lưu ý: `File test` cần được đặt trong `cùng package` với `file cần test`.
> Lưu ý: `Unit Test` không nên phụ thuộc vào nhau, mỗi `Unit Test` nên kiểm tra một phần nhỏ của mã nguồn.

Các Annotation sử dụng trong `JUnit 5`:
- `@Test` được sử dụng để đánh dấu một phương thức là một `Unit Test`.
- `@BeforeAll` được sử dụng để đánh dấu một phương thức sẽ chạy trước tất cả các `Unit Test`. Phương thức này phải là `static`.
- `@BeforeEach` được sử dụng để đánh dấu một phương thức sẽ chạy trước mỗi `Unit Test` trong class Test.
- `@AfterEach` được sử dụng để đánh dấu một phương thức sẽ chạy sau mỗi `Unit Test` trong class Test.
- `@AfterAll` được sử dụng để đánh dấu một phương thức sẽ chạy sau tất cả các `Unit Test`. Phương thức này phải là `static`.
- `@DisplayName` được sử dụng để đặt tên cho `Unit Test`. VD `@DisplayName("Test add method")`.
- `@Disabled` được sử dụng để tạm thời vô hiệu hóa một `Unit Test`. VD `@Disabled("Not yet implemented")`.
- `@Nested` được sử dụng để nhóm các `Unit Test` lại với nhau. VD `@Nested`.
- `@Tag` được sử dụng để gắn tag cho `Unit Test`. VD `@Tag("add")`.
- `@Timeout` được sử dụng để đặt thời gian chạy cho một `Unit Test`. VD `@Timeout(1000)`.

Các phương thức hay sử dụng trong `JUnit 5`:
- `assertEquals`: So sánh giá trị mong đợi với giá trị thực tế. Nếu giá trị mong đợi khác với giá trị thực tế, `Unit Test` sẽ báo lỗi. VD `assertEquals(5, calculator.add(2, 3));`. Nó có thể truyền thêm một tham số `message` để hiển thị thông báo lỗi. VD `assertEquals(5, calculator.add(2, 3), "Error: 2 + 3 != 5");`
- `assertTrue`: Kiểm tra xem một điều kiện có đúng hay không. Nếu điều kiện đúng, `Unit Test` sẽ chạy thành công. VD `assertTrue(calculator.add(2, 3) == 5);`
- `assertFalse`: Kiểm tra xem một điều kiện có sai hay không. Nếu điều kiện sai, `Unit Test` sẽ chạy thành công. VD `assertFalse(calculator.add(2, 3) == 6);`
- `assertThrows`: Kiểm tra xem một ngoại lệ có được ném ra hay không. VD `assertThrows(ArithmeticException.class, () -> calculator.divide(1, 0));`
- `assertTimeout`: Kiểm tra xem một phương thức có chạy quá thời gian cho phép hay không. VD `assertTimeout(Duration.ofMillis(100), () -> calculator.add(2, 3));`
- `assertArrayEquals`: So sánh hai mảng. VD `assertArrayEquals(new int[] {1, 2, 3}, new int[] {1, 2, 3});`
- `assertIterableEquals`: So sánh hai danh sách. VD `assertIterableEquals(Arrays.asList(1, 2, 3), Arrays.asList(1, 2, 3));`
- `assertLinesMatch`: So sánh hai danh sách chuỗi. VD `assertLinesMatch(Arrays.asList("a", "b", "c"), Arrays.asList("a", "b", "c"));`
- `assertAll`: Kiểm tra nhiều điều kiện cùng một lúc. VD `assertAll(() -> assertEquals(1, 1), () -> assertEquals(2, 2));`
- `fail`: Phương thức này sẽ báo lỗi ngay lập tức. VD `fail("Not yet implemented");`
> Nếu trong `Unit Test` có phương thức `fail`, `Unit Test` sẽ báo lỗi. Mặc định nếu không có phương thức `fail`, `Unit Test` sẽ chạy thành công.

>Calculator.java
```java
package com.example.demo;

public class Calculator {
    public int add(Integer... numbers) { // Tham số đầu vào là một các dãy số nguyên phân cách bởi dấu phẩy
		int sum = 0;
		for (int i : numbers) {
			sum += i;
		}
		return sum; // Trả về tổng của các số
	}
}
```
>CalculatorTest.java
```java
package com.example.demo;

import static org.junit.jupiter.api.Assertions.*; // Import các phương thức kiểm tra của JUnit 5

import org.junit.jupiter.api.Test; // Import annotation @Test

class CalculateTest {

	@BeforeAll // Đánh dấu phương thức setUpAll() là một phương thức thiết lập trước tất cả test case
	static void setUpAll() { // Bắt buộc phải là phương thức static
		System.out.println("Before All test case");
	}
	
	@BeforeEach // Đánh dấu phương thức setUp() là một phương thức thiết lập trước mỗi test case
	void setUp() throws Exception {
		System.out.println("Before Each test case");
	}

	@Test // Đánh dấu phương thức testAddCalculate1() là một test case
	void testAddCalculate1() {
		Calculate calculate = new Calculate();
		int actual = calculate.add(1, 2, 3, 4);
		int expected = 10;
		
		assertEquals(expected, actual); // Phuong thuc assertEquals() so sanh ket qua mong doi voi ket qua thuc te, nếu khác nhau thì hiển thị thông báo lỗi
		
//		fail("Not yet implemented"); // Phuong thuc fail() luôn fail test case và hiển thị thông báo lỗi
	}
	
	@Test // Đánh dấu phương thức testAddCalculate2() là một test case
	void testAddCalculate2() {
		Calculate calculate = new Calculate();
		int actual = calculate.add(7, 8, 9, 10);
		int expected = 34;
		
		assertEquals(expected, actual); // Phuong thuc assertEquals() so sanh ket qua mong doi voi ket qua thuc te, nếu khác nhau thì hiển thị thông báo lỗi
		
//		fail("Not yet implemented"); // Phuong thuc fail() luôn fail test case và hiển thị thông báo lỗi
	}
	
	@AfterEach // Đánh dấu phương thức tearDown() là một phương thức thiết lập sau mỗi test case
	void tearDown() throws Exception {
		System.out.println("After Each test case");
	}

	@AfterAll // Đánh dấu phương thức tearDownAll() là một phương thức thiết lập sau tất cả test case
	static void tearDownAll() { // Bắt buộc phải là phương thức static
		System.out.println("After All test case");
	}

}
