# Sử dụng Interceptors trong Axios 
`Interceptors` trong `Axios` giúp chúng ta có thể thực hiện các thao tác trước hoặc sau khi gửi request. Điều này giúp chúng ta có thể thêm `header`, `token`, `log`, `loading`, `error handling`, `response handling`,... một cách dễ dàng.

## 1. Cài đặt Axios
Để sử dụng `Interceptors` trong `Axios`, chúng ta cần cài đặt `Axios` vào ứng dụng React. Để cài đặt `Axios`, chúng ta chạy lệnh sau:
```bash
npm install axios
```

## 2. Sử dụng Interceptors
Để sử dụng `Interceptors` trong `Axios`, chúng ta sử dụng `axios.interceptors`. Dưới đây là một số ví dụ về cách sử dụng `Interceptors`:
>request.js
```typescript
import axios, { ResponseType } from "axios";

export default function apiRequest(
  endpoint: string,
  method: string,
  // eslint-disable-next-line
  body: any | undefined = null,
  responseType: ResponseType | undefined = "json",
) {
  const headers = {
    // "Content-Type": [
    //   "application/json",
    // ], // Thêm các kiểu dữ liệu mà bạn muốn gửi lên server
    // Accept: [
    //   "application/json",
    //   "text/plain",
    //   "text/html",
    //   "multipart/form-data",
    //   "application/x-www-form-urlencoded",
    // ], // Thêm các kiểu dữ liệu mà bạn muốn nhận từ server
    "Access-Control-Allow-Origin": "*", // CORS
  };

  const instance = axios.create({ headers }); // Tạo một instance axios với các headers mà bạn đã khai báo ở trên

  // Tạo 1 interceptor để xử lý với các request trước khi gửi lên server
  instance.interceptors.request.use(
    (config) => {
      const accessToken: string | null = localStorage.getItem("access_token"); // Lấy access token từ localStorage
      if (accessToken) {
        config.headers["Authorization"] = `Bearer ${accessToken}`; // Thêm access token vào header của request
      }
      return config;
    }, // Thêm vào header của request access token nếu có
    (error) => {
      return Promise.reject(error); // Xử lý khi có lỗi xảy ra khi gửi request lên server trả về 1 promise reject
    }, // Xử lý khi có lỗi xảy ra khi gửi request lên server
  );

  // Tạo 1 interceptor để xử lý với các response trả về từ server
  instance.interceptors.response.use(
    (response) => {
      return response; // Trả về dữ liệu mà server trả về
    }, // Trả về dữ liệu mà server trả về nếu không có lỗi
    async (error) => {
      const originConfig = error.config; // Lấy ra config của request gây ra lỗi
      if (error.response && error.response.status === 419) {
        // Nếu có lỗi 419 (token hết hạn) thì thực hiện refresh token (lỗi 419 do backend tự định nghĩa trả về)
        try {
          const result = await axios.post(
            "http://localhost:8888/auth/refresh-token",
            {},
            {
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
                "Access-Control-Allow-Origin": "*",
                Authorization: `Bearer ${localStorage.getItem("refresh_token")}`,
              },
            },
          ); // Gửi request lên server để lấy access token và refresh token mới
          const { accessToken, refreshToken } = result.data; // Lấy ra access token và refresh token từ response
          localStorage.setItem("access_token", accessToken); // Lưu access token vào localStorage
          localStorage.setItem("refresh_token", refreshToken); // Lưu refresh token vào localStorage
          return instance(originConfig); // Thực hiện lại request gây ra lỗi với config ban đầu (request đã bị lỗi do token hết hạn)
          // eslint-disable-next-line
        } catch (err: any) {
          // Xử lý khi có lỗi xảy ra khi gửi request lên server trả về 1 promise reject
          if (err.response && err.response.status === 401) {
            // Nếu có lỗi 401 (unauthorized) thì refreshToken đã hết hạn, phải đăng nhập lại
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");
            window.location.href = "/signin"; // Chuyển hướng đến trang signin
          }
          return Promise.reject(err); // Trả về lỗi nếu có lỗi xảy ra
        }
      }
      return Promise.reject(error); // Trả về lỗi nếu có lỗi xảy ra
    },
  );

  // Trả về kết quả của request với các interceptor đã được xử lý
  return instance.request({
    method: method, // Phương thức gửi request
    url: endpoint, // Đường dẫn gửi request
    data: body, // Dữ liệu gửi lên server
    responseType: responseType, // Kiểu dữ liệu nhận từ server
  });
}
```