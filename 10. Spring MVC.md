# Spring MVC (Model-View-Controller)
## 1. Giới thiệu về Spring MVC
Spring MVC là một framework trong Spring Framework giúp chúng ta xây dựng ứng dụng web dễ dàng hơn. Spring MVC sử dụng mô hình MVC (Model-View-Controller) để phân chia ứng dụng thành 3 phần chính:
- **Model**: Là phần dữ liệu của ứng dụng.
- **View**: Là phần hiển thị dữ liệu cho người dùng.
- **Controller**: Là phần điều khiển và xử lý dữ liệu giữa Model và View.

Spring MVC cung cấp các Annotation giúp chúng ta dễ dàng xây dựng ứng dụng web như: `@Controller`, `@RequestMapping`, `@ResponseBody`, `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping`,...

> Lưu ý: Trong Controller, chúng ta chỉ sử dụng Annotation `@Controller`, không sử dụng `@RestController` vì `@RestController` chỉ trả về dữ liệu dạng JSON hoặc XML, không phải là trang web.
> Nếu trả về 1 trang `HTML` thì phải sử dụng `StringBuilder` để nối các `tag` tạo `HTML` hoặc sử dụng `Thymeleaf` hoặc `JSP`.
> Cấu hình cho `JSP` để Java có thể hiểu được `JSP` trong file `application.properties` và thêm dependency `tomcat-embed-jasper` trong file `pom.xml` như sau, và không thêm @ResponseBody trong Controller:
```properties
# Thư mục chứa file JSP, mặc định sẽ ở thư mục src/main/resources/META-INF/resources, chỉ cần lấy phần WEB-INF/views/, nơi chứa file JSP
spring.mvc.view.prefix=/WEB-INF/views/ 
# Đuôi file JSP
spring.mvc.view.suffix=.jsp 
```
```xml
<dependency>
    <groupId>org.apache.tomcat.embed</groupId> // Thêm dependency này để Java có thể hiểu được JSP
    <artifactId>tomcat-embed-jasper</artifactId> // Thêm dependency này để Java có thể hiểu được JSP
    <scope>provided</scope> // scope provided để không đóng gói vào file WAR khi build
</dependency>
```

## 2. Tạo Controller trong Spring MVC với việc trả về chuỗi HTML
Để tạo một Controller trong Spring MVC, chúng ta tạo một class và đánh dấu class đó với Annotation `@Controller`.

Trước mỗi method, phải có @ResponseBody để trả về dữ liệu dạng HTML.

Ví dụ:
>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController {
    @RequestMapping("/hello")
    @ResponseBody
    public String hello() {
        StringBuilder html = new StringBuilder();
        html.append("<!DOCTYPE html>");
        html.append("<html>");
        html.append("<head>");
        html.append("<title>Hello</title>");
        html.append("</head>");
        html.append("<body>");
        html.append("<h1>Hello World!</h1>");
        html.append("</body>");
        html.append("</html>");
        return html.toString(); // Trả về trang web HTML
    }
}
```

## 3. Tạo Controller trong Spring MVC với việc trả về file .JSP
Để trả về file `.JSP`, chúng ta cần cấu hình trong file `application.properties` và thêm dependency `tomcat-embed-jasper` trong file `pom.xml`.

Đặc biệt trước mỗi phương thức trong Controller, không được thêm `@ResponseBody`.

Ví dụ: Tạo file `.JSP` trong thư mục `src/main/resources/META-INF/resources/WEB-INF/views/` với tên `hello.jsp`.
>`hello.jsp`
```jsp
<!DOCTYPE html>
<html>
<head>
    <title>Hello</title>
</head>
<body>
    <h1>Hello World!</h1>
</body>
</html>
```

>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController {
    @RequestMapping("/hello")
    public String hello() {
        return "hello"; // Trả về file hello.jsp (= spring.mvc.view.prefix + hello + spring.mvc.view.suffix)
    }
}
```

## 4. Sử dụng @PathVariable để truyền tham số (params) và @RequestParam để truyền tham số (query) trong URL
### 4.1. Sử dụng @PathVariable
Để truyền tham số vào URL, chúng ta sử dụng `@PathVariable`.

Ví dụ: Truyền tham số `name` vào URL và hiển thị ra màn hình.
>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController {
    @RequestMapping("/hello/{name}") // Khi truy cập vào URL /hello/{name}, thì tham số {name} sẽ được truyền vào phương thức hello. VD: http://localhost:8080/hello/John
    public String hello(@PathVariable String name) {
        System.out.println(name); // In ra màn hình giá trị của tham số name
        return ...
    }
}
```

### 4.2. Sử dụng @RequestParam
Để truyền chuỗi truy vấn vào URL, chúng ta sử dụng `@RequestParam`.

Ví dụ: Truyền query `name`, `age` vào URL và hiển thị ra màn hình.

>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class HelloController {
    @RequestMapping("/hello") // Khi truy cập vào URL /hello?name=John&age=20, thì tham số name và age sẽ được truyền vào phương thức hello
    public String hello(@RequestParam String name, @RequestParam int age) {
        System.out.println(name); // In ra màn hình giá trị của tham số name
        System.out.println(age); // In ra màn hình giá trị của tham số age
        return ...
    }
}
```

## 5. Sử dụng ModelMap để truyền dữ liệu từ Controller sang View (JSP)
Để truyền dữ liệu từ Controller sang View (JSP), chúng ta sử dụng `ModelMap`. `ModelMap` giúp chúng ta truyền dữ liệu từ Controller sang View thông qua các thuộc tính.

Ví dụ: Truyền dữ liệu `name` từ Controller sang View (JSP).
>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;

@Controller
public class HelloController {
    @RequestMapping("/hello")
    public String hello(ModelMap model) {
        model.addAttribute("name", "John"); // Truyền dữ liệu name sang View với giá trị là John
        return "hello"; // Trả về file hello.jsp
    }
}
```
>`hello.jsp`
```jsp
<h1> Hello ${name} </h1> <!-- Hiển thị giá trị của name ra WEB-->
```