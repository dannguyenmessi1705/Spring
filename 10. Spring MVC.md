# Spring MVC (Model-View-Controller)
## 1. Giới thiệu về Spring MVC
Spring MVC là một framework trong Spring Framework giúp chúng ta xây dựng ứng dụng web dễ dàng hơn. Spring MVC sử dụng mô hình MVC (Model-View-Controller) để phân chia ứng dụng thành 3 phần chính:
- **Model**: Là phần dữ liệu của ứng dụng.
- **View**: Là phần hiển thị dữ liệu cho người dùng.
- **Controller**: Là phần điều khiển và xử lý dữ liệu giữa Model và View.

Spring MVC cung cấp các Annotation giúp chúng ta dễ dàng xây dựng ứng dụng web như: `@Controller`, `@RequestMapping`, `@ResponseBody`, `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping`,...

> Lưu ý: Trong Controller, chúng ta chỉ sử dụng Annotation `@Controller`, không sử dụng `@RestController` vì `@RestController` chỉ trả về dữ liệu dạng JSON hoặc XML, không phải là trang web.
> Nếu trả về 1 trang `HTML` thì phải sử dụng `StringBuilder` để nối các `tag` tạo `HTML` hoặc sử dụng `Thymeleaf` hoặc `JSP`.
> Cấu hình cho `JSP` để Java có thể hiểu được `JSP` trong file `application.properties` và thêm dependency `tomcat-embed-jasper` trong file `pom.xml` như sau, và không thêm @ResponseBody trong Controller:
```properties
# Thư mục chứa file JSP, mặc định sẽ ở thư mục src/main/resources/META-INF/resources, chỉ cần lấy phần WEB-INF/views/, nơi chứa file JSP
spring.mvc.view.prefix=/WEB-INF/views/ 
# Đuôi file JSP
spring.mvc.view.suffix=.jsp 
```
```xml
<dependency>
    <groupId>org.apache.tomcat.embed</groupId> // Thêm dependency này để Java có thể hiểu được JSP
    <artifactId>tomcat-embed-jasper</artifactId> // Thêm dependency này để Java có thể hiểu được JSP
    <scope>provided</scope> // scope provided để không đóng gói vào file WAR khi build
</dependency>
```

## 2. Tạo Controller trong Spring MVC với việc trả về chuỗi HTML
Để tạo một Controller trong Spring MVC, chúng ta tạo một class và đánh dấu class đó với Annotation `@Controller`.

Trước mỗi method, phải có @ResponseBody để trả về dữ liệu dạng HTML.

Ví dụ:
>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController {
    @RequestMapping("/hello")
    @ResponseBody
    public String hello() {
        StringBuilder html = new StringBuilder();
        html.append("<!DOCTYPE html>");
        html.append("<html>");
        html.append("<head>");
        html.append("<title>Hello</title>");
        html.append("</head>");
        html.append("<body>");
        html.append("<h1>Hello World!</h1>");
        html.append("</body>");
        html.append("</html>");
        return html.toString(); // Trả về trang web HTML
    }
}
```

## 3. Tạo Controller trong Spring MVC với việc trả về file .JSP
Để trả về file `.JSP`, chúng ta cần cấu hình trong file `application.properties` và thêm dependency `tomcat-embed-jasper` trong file `pom.xml`.

Đặc biệt trước mỗi phương thức trong Controller, không được thêm `@ResponseBody`.

Ví dụ: Tạo file `.JSP` trong thư mục `src/main/resources/META-INF/resources/WEB-INF/views/` với tên `hello.jsp`.
>`hello.jsp`
```jsp
<!DOCTYPE html>
<html>
<head>
    <title>Hello</title>
</head>
<body>
    <h1>Hello World!</h1>
</body>
</html>
```

>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController {
    @RequestMapping("/hello")
    public String hello() {
        return "hello"; // Trả về file hello.jsp (= spring.mvc.view.prefix + hello + spring.mvc.view.suffix)
    }
}
```

## 4. Sử dụng @PathVariable để truyền tham số (params) và @RequestParam để truyền tham số (query) trong URL
### 4.1. Sử dụng @PathVariable
Để truyền tham số vào URL, chúng ta sử dụng `@PathVariable`.

Ví dụ: Truyền tham số `name` vào URL và hiển thị ra màn hình.
>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HelloController {
    @RequestMapping("/hello/{name}") // Khi truy cập vào URL /hello/{name}, thì tham số {name} sẽ được truyền vào phương thức hello. VD: http://localhost:8080/hello/John
    public String hello(@PathVariable String name) {
        System.out.println(name); // In ra màn hình giá trị của tham số name
        return ...
    }
}
```

### 4.2. Sử dụng @RequestParam
Để truyền chuỗi truy vấn vào URL, chúng ta sử dụng `@RequestParam`.

`@RequestParam` cũng được sử dụng để đọc từ `form data` hoặc `query parameters` từ URL.

Ngoài ra `@RequestParam` còn có thể truyền giá trị mặc định cho tham số bằng cách thêm tham số `defaultValue`.

Ví dụ: Truyền query `name`, `age` vào URL và hiển thị ra màn hình.

>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class HelloController {
    @RequestMapping("/hello") // Khi truy cập vào URL /hello?name=John&age=20, thì tham số name và age sẽ được truyền vào phương thức hello
    public String hello(@RequestParam String name, @RequestParam int age) {
        System.out.println(name); // In ra màn hình giá trị của tham số name
        System.out.println(age); // In ra màn hình giá trị của tham số age
        return ...
    }
}
```

## 5. Sử dụng ModelMap để truyền dữ liệu từ Controller sang View (JSP)
Để truyền dữ liệu từ Controller sang View (JSP), chúng ta sử dụng `ModelMap`. `ModelMap` giúp chúng ta truyền dữ liệu từ Controller sang View thông qua các thuộc tính.

Ví dụ: Truyền dữ liệu `name` từ Controller sang View (JSP).
>`HelloController.java`
```java
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.SessionAttributes;

@Controller
@SessionAttributes("name") // Lưu trữ attribute name vào Session
public class HelloController {
    @RequestMapping("/hello")
    public String hello(ModelMap model) {
        model.addAttribute("name", "John"); // Truyền dữ liệu name sang View với giá trị là John
        return "hello"; // Trả về file hello.jsp
    }

    @RequestMapping("/sub-hello") // redirect sang URL /hello
    public String subHello(ModelMap model) {
        String name = (String) model.get("name"); // Lấy dữ liệu name từ View, nếu trước đó đã truy cập vào URL /hello, thì sẽ có dữ liệu name, nếu không sẽ trả về null, do đã lưu vào Session
        return "redirect:hello"; // redirect sang URL /hello
    }
}
```
>`hello.jsp`
```jsp
<h1> Hello ${name} </h1> <!-- Hiển thị giá trị của name ra WEB-->
```

## 6. Sử dụng JSTL (JavaServer Pages Standard Tag Library) trong JSP để hiển thị dữ liệu
`JSTL (JavaServer Pages Standard Tag Library)` là một thư viện tag chuẩn của JSP giúp chúng ta thực hiện các thao tác logic, điều kiện, vòng lặp, hiển thị dữ liệu, ...Tương tự như `ejs` trong `Node.js`.

Để sử dụng `JSTL`, chúng ta cần làm các bước sau:
1. Thêm dependency `jstl` trong file `pom.xml` (mvnrepository.com).
>pom.xml
```xml
		<dependency>
			<groupId>jakarta.servlet.jsp.jstl</groupId>
			<artifactId>jakarta.servlet.jsp.jstl-api</artifactId>
		</dependency>

		<dependency>
			<groupId>org.eclipse.jetty</groupId>
			<artifactId>glassfish-jstl</artifactId>
			<version>11.0.21</version>
		</dependency>
```
2. Thêm thẻ `taglib` vào đầu file `.jsp` để sử dụng `JSTL`. `https://docs.oracle.com/javaee/5/jstl/1.1/docs/tlddocs/index.html`. Bắt buộc phải thêm thẻ `taglib` vào đầu file `.jsp` nếu dùng `JSTL`. Vì khi thêm `dependency` `jstl` vào `pom.xml`, thì file `.jsp` bình thường sẽ không được render ra HTML nếu không thêm thẻ `taglib`.

`<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>` để sử dụng thư viện `JSTL Core` với thẻ tag ;à `<c>`.Khi sử dụng `JSTL Core`, chúng ta có thể sử dụng các thẻ như:
- `<c:if>`: Thực hiện một câu lệnh if.
- `<c:choose>`: Thực hiện một câu lệnh switch-case.
- `<c:forEach>`: Thực hiện một vòng lặp.
- `<c:out>`: Hiển thị dữ liệu.
- `<c:set>`: Gán giá trị cho biến.
- `<c:remove>`: Xóa giá trị của biến.
- `<c:import>`: Import một file.
- `<c:redirect>`: Chuyển hướng trang.
- `<c:url>`: Tạo URL.
- `<c:param>`: Thêm tham số vào URL.
- `<c:catch>`: Bắt lỗi.
- `<c:when>`: Thực hiện một câu lệnh if trong `<c:choose>`.
- `<c:otherwise>`: Thực hiện một câu lệnh else trong `<c:choose>`.
- `<c:forTokens>`: Thực hiện vòng lặp với chuỗi được tách ra từ một chuỗi khác.

`<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>` để sử dụng thư viện `JSTL Format` với thẻ tag là `<fmt>`.Khi sử dụng `JSTL Format`, chúng ta có thể sử dụng các thẻ như:
- `<fmt:formatDate>`: Định dạng ngày tháng.
- `<fmt:formatNumber>`: Định dạng số.
- `<fmt:formatMessage>`: Định dạng thông điệp.
- `<fmt:parseDate>`: Chuyển đổi ngày tháng.

`<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %> ` để sử dụng thư viện `JSTL SQL` với thẻ tag là `<sql>`.Khi sử dụng `JSTL SQL`, chúng ta có thể sử dụng các thẻ như:
- `<sql:setDataSource>`: Thiết lập nguồn dữ liệu.
- `<sql:query>`: Thực hiện một câu lệnh truy vấn.
- `<sql:update>`: Thực hiện một câu lệnh cập nhật.
- `<sql:param>`: Thêm tham số vào câu lệnh truy vấn hoặc cập nhật.

`<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>` để sử dụng thư viện `JSTL Functions` với thẻ tag là `<fn>`.Khi sử dụng `JSTL Functions`, chúng ta có thể sử dụng các thẻ như:
- `<fn:contains>`: Kiểm tra chuỗi có chứa chuỗi con không.
- `<fn:containsIgnoreCase>`: Kiểm tra chuỗi có chứa chuỗi con không (không phân biệt chữ hoa chữ thường).
- `<fn:endsWith>`: Kiểm tra chuỗi kết thúc bằng chuỗi con không.
- `<fn:escapeXml>`: Escape XML.
- `<fn:indexOf>`: Trả về vị trí đầu tiên của chuỗi con trong chuỗi.
- `<fn:join>`: Nối các phần tử của một mảng thành một chuỗi.
- `<fn:length>`: Trả về độ dài của chuỗi.
- `<fn:replace>`: Thay thế chuỗi con trong chuỗi.
- `<fn:split>`: Tách chuỗi thành mảng.
- `<fn:startsWith>`: Kiểm tra chuỗi bắt đầu bằng chuỗi con không.
- `<fn:substring>`: Trích xuất một phần của chuỗi.
- `<fn:substringAfter>`: Trích xuất phần sau của chuỗi.
- `<fn:substringBefore>`: Trích xuất phần trước của chuỗi.
- `<fn:toLowerCase>`: Chuyển đổi chuỗi thành chữ thường....
- ...


Ví dụ: Sử dụng `JSTL` để hiển thị dữ liệu từ Controller sang View (JSP) qua ModelMap.
>`hello.jsp`
```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
    <title>Hello</title>
</head>
<body>
    <h1> Hello ${name} </h1> <!-- Hiển thị giá trị của name ra WEB-->
    <c:if test="${name == 'John'}"> <!-- Nếu name == 'John' thì hiển thị ra màn hình -->
        <h2> Welcome ${name}! </h2>
    </c:if>
</body>
</html>
```

## 7. Sử dụng Bootstrap và Jquery trong JSP
`Bootstrap` và `Jquery` là 2 thư viện phổ biến giúp chúng ta xây dựng giao diện web đẹp và tương tác với người dùng dễ dàng hơn.

Để sử dụng `Bootstrap` và `Jquery` trong `JSP`, chúng ta cần thực hiện các bước sau:
1. Thêm dependency `webjars` trong file `pom.xml` (mvnrepository.com).
>pom.xml
```xml
		<dependency>
			<groupId>org.webjars</groupId>
			<artifactId>bootstrap</artifactId>
			<version>5.3.3</version>
		</dependency>


		<dependency>
			<groupId>org.webjars</groupId>
			<artifactId>jquery</artifactId>
			<version>3.7.1</version>
		</dependency>
```
2. Copy đường dẫn của `Bootstrap` và `Jquery` từ `webjars` vào file `.jsp`.
- Sau khi thêm `dependency` `webjars` vào `pom.xml`, chúng ta mở maven dependencies, tìm đến `bootstrap` và `jquery`, copy đường dẫn của `bootstrap` và `jquery` vào file `.jsp`.
- Đường dẫn bootstrap css: `/META-INF/resources/webjars/bootstrap/5.3.3/css/bootstrap.min.css`
- Đường dẫn bootstrap js: `/META-INF/resources/webjars/bootstrap/5.3.3/js/bootstrap.min.js`
- Đường dẫn jquery js: `/META-INF/resources/webjars/jquery/3.7.1/jquery.min.js`

3. Thêm đường dẫn của `Bootstrap` và `Jquery` vào file `.jsp` qua thẻ `link` và `script`. Vì `SpringBoot` hiểu đường dẫn `/META-INF/resources/` nên không cần thêm prefix này vào đường dẫn.
>`hello.jsp`
```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
    <title>Hello</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css"> <!-- Thêm Bootstrap -->
</head>
<body>
    <h1> Hello ${name} </h1> <!-- Hiển thị giá trị của name ra WEB-->
    <c:if test="${name == 'John'}"> <!-- Nếu name == 'John' thì hiển thị ra màn hình -->
        <h2> Welcome ${name}! </h2>
    </c:if>
    <script src="/webjars/jquery/3.7.1/jquery.min.js"></script> <!-- Thêm Jquery -->
    <script src="/webjars/bootstrap/5.3.3/js/bootstrap.min.js"></script> <!-- Thêm Bootstrap -->
</body>
</html>
```

