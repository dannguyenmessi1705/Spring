#!/bin/sh

set -e

export VAULT_ADDR="http://127.0.0.1:8200"
export VAULT_FORMAT="json"
export VAULT_TOKEN="root"

vault server -dev -dev-listen-address="0.0.0.0:8200" &
sleep 5s

echo "✅ Vault đã khởi động. Tiến hành cấu hình..."

vault login -no-print "${VAULT_TOKEN}"

echo "🔹 Bật Key Value Secrets Engine..."
vault secrets enable -path=kv kv-v2

echo "🔹 Tạo dữ liệu bí mật..."
vault kv put kv/switching-bidv viettel-private-key="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" partner-public-key="MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA2CGSo2hNSvzrYO6msIqmJV7eGwGXFGmLAVOwW6Vd4x+ab95ZZ/Bm8upd/8lBiHFHol9SuPztLm43DhB1pwXF2D6exDyOd1Yp+P3D7T03YwwPwTmVNGS7Yy7QAbPS5vN5UWR5Z/RYERTC+OEx6XUSDrIHeFTfzyS01R/+HnIGqXSKKbu81cuFMnQOlmcCy//XrsMOXxGoLCFms62PhVqan7UEHn96zyGly+GAzemaY53b97rzBNIUpp166vHiIswvOHVrTtwqVMHOFbN6o8WqRdPlJGaOMMJSmfju1aKCB69oAKW591sJCI+Xla2FHUzVcvYietYSn7jcUWR1K3kGYo6YkzyfA4XRPmzOMeaHCPkJFpsYEQcYjh8YFEJDEy5SJbPWbMqXg7OW9kYDeBtYdXzQBpVxsCjB5HKVRgbuFuy7hAMrafwAw0IHBWJuaUoueit5XmxFrsCnD9h/uBRwwCvnvL6XSanqIqaG3up6qRMEDZ4x9Kj8aTd0hV8+KIo40SMJE21Ygqr2zx+b4AAA8q9v1qEUymiYlfb7QuQ6fBqqKnx2KDIfAvNruSWtzZec5KzlLyVwQJ1VvP6pwVaH51rCaH77j15hFxIzcwcOMstCcLUqkwi/MsKQepSjMUzun/xBRfSa+sEwoPib9yRsl/fHlsnzt16t65oH7HKxItMCAwEAAQ=="
vault kv put kv/switching-vietinbank viettel-private-key="MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDa9vyA0KW5BV4mfAsgQhEdZ1lAgXVW32g1/1OFleu2lPlJMDOtaITGUFFMEUPpb4ZOBgmlX1bsT1Ds/roLeUT0+X9n4WJdAcxVvUP6y83RKNLnSbYdELumngzeuVrvabIYUqS2j/2B6p+6ci1bZh+JtiHHkvyeZidpbioHLoUE6LZHtA9+MZJiyNO1LIl1t0C9pQ46glaRqMUyYfiZQbm1k/FA6LwlzyWRiz52MXddI8WN14KhS5+Hb80h5b6yHAmx48yLbH3avSO9YGHidN76ws8ZJjxthqDVhPyTbHmjR4ckimoRSXFm70ko6ehgWMdo37Xoys5BY/fElHODQYrrAgMBAAECggEAQJi4qS/klA7XVbcmeR/EeM4ycGtAuJ4z2io286Pk4/pTCJplxHSfJvou4af+RvGVx5LUaasUs6Y6k5AaRqRCCZtJUNYW9KVBKNIrKePSFjBa98yxIyX6lg7ucQ5xm0utNKu81/bmrNsQwCpK4znfd/r5QC1GxVwRqHLNh0zcBTQuQsvuheqm9K8LRfP9TpW4xL6rFHECCyZG1y2dl+ujDBR+uXwOFgIm0DipZZ5gg1GJhPYhcXxTPWlIGIxVfLQ3qZiu9A+bckDGcDMoLBilXJWbgMQpgq4DQrK1XGpCE89RXLsCbzRsGpp/qs5JIcFCj9r8uY8tMbLE6NGCeP9wkQKBgQDzZmQ3u/wzWY2n9X93P1YKAZwoRW/PqAdWpKL3nNfwBArYiLzWXFfzYf1Io36KagFZXf763Fdz4wIpSyiWOWJtlmJLEJX8Od98ZaNhzqhK5JwRiEyAeGyRcemZypBl4Ct7GmqM3BAqrQp3IBoBZOxqt69oUAq3BrDpfAjGZMm3nwKBgQDmTMXNTODbKk6VKOXv/YJ1A32AClzUIbA8PtL8yBGd8wE1Inxa6lORK9PZ0/kZyZw6XjGVXA/wuUM4/KD0V3D3Gf3pA5UuotlavovRjwIhxku1Pt3+fsLAEQl4Wjk72tGeFhbfDw1TWCr3nxIbkxRim/uR8GgU4yakGL2GQ3AZNQKBgHPM5ylNGrQjiy25syc8zuZ71ZujTYryWmtycMZ1rJbYlYBnrdAepwl4OVTx1CZuQK4P9lvLsR/FhSW4SFsQei/BOIqWHYWe0yEQCididtcK5OXCfwMwSBb6pzUwFnshqA4thzv1BwwGv8/lSfoX1hL/yUhLrI1fdZPgGxyonv/pAoGAAaM2HNmZF7XbTTA3QleZH9/gepKYSmHa8PK5aVa62VarAYe3PqY/5d5b6UaalNZcKAYXcCpxapLGqZcSReqBQSCML6X435YE2aJVOC4+I6NXUniZ939LPzZfzN1HXueVafxaOUfQHnGYDJ6y8ENBd9oIFeeRteRPmAcdAeFk4KkCgYA9/o3DVCxOtcAsfmw5TYtIV+STII6JCxNj9RexNsKb3g8Lpsx872L9JRTn6yMAblNVrEomf1EN9Kanai6SC15z6Rll1auPpqfbN9GKlOxmVYAfEiK7IDvYk7IQ9H/42xBuZHaIXPXRRApnvKEhDsIAZHlnPwEZADYAxtlb5SFm/g==" partner-public-key="MIIEoTCCA4mgAwIBAgIQVAT//rcDP7MW1nIgG5ZvljANBgkqhkiG9w0BAQsFADBCMQswCQYDVQQGEwJWTjEWMBQGA1UECgwNVmlldHRlbCBHcm91cDEbMBkGA1UEAwwSVmlldHRlbC1DQSBTSEEtMjU2MB4XDTIzMDgyMzExMDgxOFoXDTI1MDkyNDEwNDExMVowgbExCzAJBgNVBAYTAlZOMRIwEAYDVQQHDAlIw4AgTuG7mEkxSTBHBgNVBAMMQE5Hw4JOIEjDgE5HIFRIxq/GoE5HIE3huqBJIEPhu5QgUEjhuqZOIEPDlE5HIFRIxq/GoE5HIFZJ4buGVCBOQU0xHjAcBgoJkiaJk/IsZAEBDA5NU1Q6MDEwMDExMTk0ODEjMCEGCSqGSIb3DQEJARYUVHV5ZXRwdDRAdmlldHRlbC5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDO3/cB/8oQEXV95DX8As8+7XF9RFHCq0g/MeK5t763YzUmVHLMNTkbY5JCjuHlRzzBYZYM2S0IHB9Dqz05v90+0UtfgH8qxNFgZcapJB4n1UJES1g0Jru3jgpRDY1g5KiP+borXidE4sBE7EH+H6MyIdmD2nONC8dDI49o4lSOWFebZ/R4NSntKHyu66JZpKEP5yBuTzWGYoXKnsI6VQ/NO3u2J0OPUj8a4kwksJ4Frz83/tvpEHinBKi9x+F7a1yF1qaYzTWkzzuatmSvBvkllxZzUye41pEUegSwd1dRuIeoIEsglgBtGfVe3Ignzs/d4Vh2ppQxHaE5bqeBvhZ1AgMBAAGjggEhMIIBHTA1BggrBgEFBQcBAQQpMCcwJQYIKwYBBQUHMAGGGWh0dHA6Ly9vY3NwLnZpZXR0ZWwtY2Eudm4wHQYDVR0OBBYEFIw+26ahE35iiiR5g35jKhJHnxq/MAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAUul8b6XkDfjjSXv70mz9qCOQue+EwgYUGA1UdHwR+MHwweqAwoC6GLGh0dHA6Ly9jcmwudmlldHRlbC1jYS52bi9WaWV0dGVsLUNBLVNIQTIuY3JsokakRDBCMRswGQYDVQQDDBJWaWV0dGVsLUNBIFNIQS0yNTYxFjAUBgNVBAoMDVZpZXR0ZWwgR3JvdXAxCzAJBgNVBAYTAlZOMA4GA1UdDwEB/wQEAwIF4DANBgkqhkiG9w0BAQsFAAOCAQEAjSzoOXJBGbXQwCUdQctFTL99K7aGS8CDmHiANuN1oJVVDoxFeojOno6w5DVwjADMI+qFiphLwHTswkd9s5oxPFRVFui1X5tY08tWZ0KssqgDD+/KkB1tm4uh1UjgxBo+meVp7LG+jtExhe+D8wbU0+mffG4V2zwjlKaIgy6DVEglrxHL9GhbIU9LEl6PxCgvsbvtfqanswexxX+rAqcReNCKNDUaedfR173q88+JY0i3pM6hl25i6kt9+6Hyds4eNwLWLUjAft1obGfiB63UbQlIV15QR/K3MaugeJ2cQ4P08KNWPzoezk4zOb3sfB4M5+bgA1x+vfDwjwOyglHSHg=="
vault kv put kv/switching-vpb viettel-private-key="MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDzp31hzS72Rzax4Te48Yo5dHzzpr4KUHGijRFPlb5hIFtaem5zHcBKUWCvL+4OaqnGCnWYkOtuHCZQBX7zp3EOmrG1N9guFtZdYHNiYl/QBVwdpImyMQ/u9Qg/oyKgtIxbVnXIKoFjKwqihxxE26ZM41/VyIUsRXTa5aruHMcbcnZRPzkUMLBraH6F5RrhPZsNP7tmhknutQxAxr9zIDSfBcyTJd8b2G8hCnb7sNYvoM8BNuOjyAtoGyWSzvLNsBVslbG6elizmiVWifRMvbR/lfk2VYJT4FEj91KqClA436CcwhcPF2V2L6ExfSv0mH1m+iiLlxK5hTyf4NqTGLjlAgMBAAECggEBAI4xAoTe3zcuXAb27jPqEcZx6rGub11JkOdR9/Y/5zh7T5S/ulFH3X4Be7EBAaY8LRO76uC8QgiiOOGeM3YyE1J4iJi/HFPZVARuUyfpTQzy880AxrLM2wWSzduFcqHie76Z+GZ2F8gtyCkNPDwbCzP3xWfXe5BYgFd2jIglFzU2Na4KDIhVlhmvz8vfd4YMnvabawQpPJt0sLFPqoQ8XIiOLOKVbZxUAvBjJSj6DOSaoCDZKc76GwBBgn7V0fpD78p8vGPWfJ/3XjnA8yGgb+JX4D4qoDoED2UqDgcBBz9xB2lg526zP6I8hUnrQPKRAAyTMsqjpAU/q2DbLJJMSIECgYEA/4MOGRJSu16YDs6xOABoTLKrYTkZGjgDJt5q+WVvSZbVJ91dvc100wAsyFWvuuO6VRhf6ht4jv4kWaHVc/m7DWjE8E6ofsbZjbuoruHn6QlKrEC+1edOydymCzI7ZhMcOzk6qhgeRI5WUJdC5n6tYCFc7CiO2Oe67bv/8nKcArUCgYEA9B6i5cH/KuJWeH/n5GTsB8vHEJeA6ei6FoBNh/A4apc9LWnLgJi+PrKcIQa+hTyrSYu2AvFOM3PF+BpPxPLXchPSoyLJpFVipAwjwjGiogK5wMUpcjn2r0jA60BJBBaiUwu8HI0yn6FyDPEGguUVp3gPwLEdoJXwYGxzAM1+y3ECgYEA1/aMlvJezRICEhnvvnbRsWoe4tkg94E6YMMDxfJPYvLDDaPUVNXwlVuDfny2QI+08bHdeAFqH+p9DOl1gkYlLQtN0hOZ5TXrshlYVSCKJPT+kaNT6XZNqN7/1VzKydcDOKeBhz1FcAqiuBFxsWKG5kasxMrvGjSbUc9iYSkv5jUCgYBZM1SclZ1ygw/LqhkGyKXCV4CenG17ixFsJWevE2TZ9fdhv7WfgLCLYmJQYxF8x+Vi000nmBrWDCi7donNUlrNEVc3Sv/ZL2YCwXjTfaWKg2pyeNijJ3DvLatoiq3jc43OwIv09tcXozt0ZSHW9HRMJD/FTjKgOgmCgj4nfe8l0QKBgEL4ZZi5G1z7Vn4arxJk52nrZbFxaFA7odoReHRMg7LBEt5qh9M2gO21/wCfdvrrS0DaRn9TGEHFA4KT89WSPYxGssgw/aySFSQOD693eCLCgx8NKyKG2ciBiLhhGFlAQ5cXhEpQWFJgfzLZ3STOnyAOFsMceqivZBnElvzNNbTo" partner-public-key="MIID7TCCAtWgAwIBAgIJAIBhHE93qETLMA0GCSqGSIb3DQEBCwUAMIGMMQswCQYDVQQGEwJWTjEPMA0GA1UECAwGSGEgTm9pMQ8wDQYDVQQHDAZIYSBOb2kxDDAKBgNVBAoMA1ZEUzEYMBYGA1UECwwPVmlldHRlbCBEaWdpdGFsMQwwCgYDVQQDDANWVFQxJTAjBgkqhkiG9w0BCQEWFm1pbmh0ZDlAdmlldHRlbC5jb20udm4wHhcNMjAwNjExMTAyNTI1WhcNMzAwNjA5MTAyNTI1WjCBjDELMAkGA1UEBhMCVk4xDzANBgNVBAgMBkhhIE5vaTEPMA0GA1UEBwwGSGEgTm9pMQwwCgYDVQQKDANWRFMxGDAWBgNVBAsMD1ZpZXR0ZWwgRGlnaXRhbDEMMAoGA1UEAwwDVlRUMSUwIwYJKoZIhvcNAQkBFhZtaW5odGQ5QHZpZXR0ZWwuY29tLnZuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA86d9Yc0u9kc2seE3uPGKOXR886a+ClBxoo0RT5W+YSBbWnpucx3ASlFgry/uDmqpxgp1mJDrbhwmUAV+86dxDpqxtTfYLhbWXWBzYmJf0AVcHaSJsjEP7vUIP6MioLSMW1Z1yCqBYysKooccRNumTONf1ciFLEV02uWq7hzHG3J2UT85FDCwa2h+heUa4T2bDT+7ZoZJ7rUMQMa/cyA0nwXMkyXfG9hvIQp2+7DWL6DPATbjo8gLaBslks7yzbAVbJWxunpYs5olVon0TL20f5X5NlWCU+BRI/dSqgpQON+gnMIXDxdldi+hMX0r9Jh9Zvooi5cSuYU8n+Dakxi45QIDAQABo1AwTjAdBgNVHQ4EFgQUq4CFDZyaiPSiNS3z1pHy6wbjWe8wHwYDVR0jBBgwFoAUq4CFDZyaiPSiNS3z1pHy6wbjWe8wDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEArYoOCmvsNGv8ZV2KjblhpDZktkXzJFIsBpSk4WEfOqmjnN7LHRXTE9r2cyp3Ww1MT/cweLwExngjY6CLbY7l39dwb4qEUJc++DdK/FJbnEy3GG+rFczAMKXK9ZEbeCP3qZhMD1SHDF9eo3o/UFistE8cfd3+HCyPr9QFYaawYXkdlp96IIVFnbbTwIeXCYu2UA95ApoxgYtMbLFrJrYa3YX9dheVs6GXF718eGRH9pe9qyw/VQlx006nrbjypSb6mXRckl0VN/EHZ3z1u2BT2gxXO8ieaPEWKukYHrfl4Wi1XxQTSS9eWvFUhQqTmNVJYpvbXMGatRiQwKgsDgyoJg=="
vault kv put kv/switching-vba viettel-private-key="MIIEowIBAAKCAQEApUfZeKrzDWXD/9FNlEMWiZyvEZznVy3CGYAoABcpMJAf0lhVATSxhGMOJGhMUXowqHxwINNegJ5T9u71nySIJ7en283PxCJgFFKlJD7XUVinARWdK1YVn7VEPHuBspGbnR3QjsiLSn/aDBTi5iGwennmuIidOVBn/+QpQjZCAEeC1/zgJ1bSY1Q7gr+TI3ZAIFPuvC1L7H2IBGn/fjkmH8t6dmVwAkPfA1LLTmkRM6dcm7M2hm+Nf+uOGZE0+eCQEqqNhmSMLJ2NccmIMWcDtrsydlGWisWYRt5mHkOipvDQo2twtArKtDcjqXA3UCtPSwO86WStIUkyp41HgOQCVQIDAQABAoIBADa1YrHDfDJaFheOc2x5DHO+jmB5HEZKGi6Qsizdfb/aZP4eSPzeMUhN9Xdtop1xobuTfRYQgP536fkZvenQkNT8wK5MINKeQklX1dv6hREjFBySx/R5SS0VNiIDC7pM4kKOhONOVHTzfvxyyWw9iInx4cIBTnGTQOl9335QMWafvNZ2LgVX57YZpuUDkh+jzQt0VITRI2+Bm2Lg/WZgkA4NqZmcRpSnHI99sxGCHjgnAYWnJn3n13KYEdEc1HzI+qmlY7djyFlXMcTlJxoZpvWXSBEkNqahdZwcmgOaq4pSjwYgXgl/Z42sgwoP9qeh65fEOw+ho9Cvo+lzXyFVRT0CgYEA1VeSDBl5mdFIuW5fIr8Hj7ARSLwlxOCaIfzEmF0kTuKj2CVgVwl9jnTG0WCFyFaB+nTzXXCWgyfjcAGNzux5E+ocf/Hw5PSS7sd/M78SQ3OUuzYj8xJtUK6toq3jwtnrhevt7t+GAtS/ecWDSHxIq4QHCJY4AIF5lO6p46Qa3k8CgYEAxlQju7DNUAHeCeziizy5BxcugR7AZlCFy0DjdhOqADd1UAZMFBxPrSD+oOxgBlyeQ+vOnACjLSDSAUL/ML1jPj4mcopYHNakHVkrwN8gtS2iVWZ7LIFxMFb2sGPASXqyCAtqJsllmg9zH6VqVYlzCN5kA0OBmeRkrge6R7t0cBsCgYBXqj5XPnibXkZV/CaXrou63YycqMOUXP65DJb0TQHIcJUHEoS9/yZazV2NV+5hXjrW4gvGz6bpihCJS/orlzxBlKfVY2OrkVx3Rf7dEpy8ntf0/dBT57SHvN+Yw3+d59JCG6qPx8XXj/iGX0UNGhT6daw2ORQWER4WtuOUqTBpPQKBgQC6waZ4am+bhHaioAdgGAkf7StkeSGx9udWUz8eBDxUQeTdO2DOmy5IGEbOIGf39aUuzlFbQ5pkt4Apof4N1nkqtnmb6Dw6w7/8xuhVkYcKNPOlOYCJk0aTv4BC71u1la0puB34cjOTlDLTPP/ZljnVwx0omZvj31cTLcGzJIjruwKBgAfaOx/7khd2QAiEOB82p3IBYPE6LP74XXofwSMD1sZ89s5ifc2iNJ43QllHdPZiRri0piFvHgICC5FL4YinN3LhBEn3bj8rx1CZsGHvscCNvakzUZNtIzmVn2eJsdtjfsWovPZrzgqD0GBR4MC1iMxW7jTNB87xHK3ZyuU61BYe" partner-public-key="MIID7TCCAtWgAwIBAgIJAIBhHE93qETLMA0GCSqGSIb3DQEBCwUAMIGMMQswCQYDVQQGEwJWTjEPMA0GA1UECAwGSGEgTm9pMQ8wDQYDVQQHDAZIYSBOb2kxDDAKBgNVBAoMA1ZEUzEYMBYGA1UECwwPVmlldHRlbCBEaWdpdGFsMQwwCgYDVQQDDANWVFQxJTAjBgkqhkiG9w0BCQEWFm1pbmh0ZDlAdmlldHRlbC5jb20udm4wHhcNMjAwNjExMTAyNTI1WhcNMzAwNjA5MTAyNTI1WjCBjDELMAkGA1UEBhMCVk4xDzANBgNVBAgMBkhhIE5vaTEPMA0GA1UEBwwGSGEgTm9pMQwwCgYDVQQKDANWRFMxGDAWBgNVBAsMD1ZpZXR0ZWwgRGlnaXRhbDEMMAoGA1UEAwwDVlRUMSUwIwYJKoZIhvcNAQkBFhZtaW5odGQ5QHZpZXR0ZWwuY29tLnZuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA86d9Yc0u9kc2seE3uPGKOXR886a+ClBxoo0RT5W+YSBbWnpucx3ASlFgry/uDmqpxgp1mJDrbhwmUAV+86dxDpqxtTfYLhbWXWBzYmJf0AVcHaSJsjEP7vUIP6MioLSMW1Z1yCqBYysKooccRNumTONf1ciFLEV02uWq7hzHG3J2UT85FDCwa2h+heUa4T2bDT+7ZoZJ7rUMQMa/cyA0nwXMkyXfG9hvIQp2+7DWL6DPATbjo8gLaBslks7yzbAVbJWxunpYs5olVon0TL20f5X5NlWCU+BRI/dSqgpQON+gnMIXDxdldi+hMX0r9Jh9Zvooi5cSuYU8n+Dakxi45QIDAQABo1AwTjAdBgNVHQ4EFgQUq4CFDZyaiPSiNS3z1pHy6wbjWe8wHwYDVR0jBBgwFoAUq4CFDZyaiPSiNS3z1pHy6wbjWe8wDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEArYoOCmvsNGv8ZV2KjblhpDZktkXzJFIsBpSk4WEfOqmjnN7LHRXTE9r2cyp3Ww1MT/cweLwExngjY6CLbY7l39dwb4qEUJc++DdK/FJbnEy3GG+rFczAMKXK9ZEbeCP3qZhMD1SHDF9eo3o/UFistE8cfd3+HCyPr9QFYaawYXkdlp96IIVFnbbTwIeXCYu2UA95ApoxgYtMbLFrJrYa3YX9dheVs6GXF718eGRH9pe9qyw/VQlx006nrbjypSb6mXRckl0VN/EHZ3z1u2BT2gxXO8ieaPEWKukYHrfl4Wi1XxQTSS9eWvFUhQqTmNVJYpvbXMGatRiQwKgsDgyoJg=="

echo "🔹 Tạo chính sách truy cập..."
vault policy write my-policy /policy.hcl

echo "🔹 Bật AppRole Authentication..."
vault auth enable approle

echo "🔹 Tạo Role cho AppRole..."
vault write auth/approle/role/my-role secret_id_ttl=0s token_ttl=0s token_max_ttl=0s token_policies=my-policy

echo "🔹 Lấy Role ID..."
ROLE_ID=$(vault read -field=role_id auth/approle/role/my-role/role-id)
echo "ROLE_ID=$ROLE_ID"

echo "🔹 Lấy Secret ID..."
SECRET_ID=$(vault write -f -field=secret_id auth/approle/role/my-role/secret-id)
echo "SECRET_ID=$SECRET_ID"

echo "🔹 Gán approle, Role ID & Secret ID vào biến môi trường cho Spring Boot..."
mkdir -p /vault/secrets/
echo "VAULT_TOKEN=$VAULT_TOKEN" > /vault/secrets/vault-credentials.env
echo "VAULT_ADDR=$VAULT_ADDR" >> /vault/secrets/vault-credentials.env
echo "ROLE_ID=$ROLE_ID" >> /vault/secrets/vault-credentials.env
echo "SECRET_ID=$SECRET_ID" >> /vault/secrets/vault-credentials.env

echo "✅ Vault đã được cấu hình hoàn tất!"

# this container is now healthy
touch /tmp/healthy

# keep container alive
tail -f /dev/null & trap 'kill %1' TERM ; wait