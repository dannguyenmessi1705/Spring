# OAuth2 với Google
## 1. Giới thiệu
- `OAuth2` là một giao thức cho phép ứng dụng yêu cầu quyền truy cập vào tài nguyên của người dùng từ một ứng dụng khác mà không cần biết mật khẩu của người dùng.

## 2. Cách thức hoạt động
- `OAuth2` hoạt động theo các bước sau:
    - Bước 1: Ứng dụng yêu cầu quyền truy cập vào tài nguyên của người dùng thông qua một `Authorization Server`.
    - Bước 2: `Authorization Server` yêu cầu người dùng cung cấp thông tin đăng nhập.
    - Bước 3: Người dùng cung cấp thông tin đăng nhập.
    - Bước 4: `Authorization Server` cung cấp một mã `Authorization Code`.
    - Bước 5: Ứng dụng sử dụng mã `Authorization Code` để yêu cầu `Access Token`.
    - Bước 6: `Authorization Server` cung cấp `Access Token`.
    - Bước 7: Ứng dụng sử dụng `Access Token` để truy cập tài nguyên của người dùng.

## 3. Cấu hiện `OAuth2` với Google trong Spring Boot
### 3.1. Xác minh người dùng với Google
Để xác minh người dùng với Google, chúng ta cần truy cập vào trang [Google Developers Console](https://console.developers.google.com/).

> Lưu ý: Phần tạo Credentials, trong mục `Authorized redirect URIs` chúng ta cần thêm `http://localhost:8080/login/oauth2/code/google`. Với `http://localhost:8080` là địa chỉ của ứng dụng Spring Boot. prefix `/login/oauth2/code/google` là mặc định của Spring Security.

### 3.2. Thêm `client-id` và `client-secret` vào `application.properties`
Sau khi tạo `Credentials` trên `Google Developers Console`, sẽ xuất hiện `client-id` và `client-secret`. Chúng ta cần thêm vào file `application.properties` như sau:
```properties
spring.security.oauth2.client.registration.google.client-id=YOUR_CLIENT_ID
spring.security.oauth2.client.registration.google.client-secret
```

### 3.3. Thêm `OAuth2` dependency
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-oauth2-client</artifactId>
</dependency>
```

### 3.4. Tắt `Basic Authentication`, `Form Login` và để `OAuth2` xử lý trong `Spring Security`
>SecurityConfig.java
```java
@Configuration
public class SecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeRequests(authorizeRequests ->
                authorizeRequests
                    .anyRequest().authenticated()
            )
            .formLogin(form -> form.disable()) // Tắt Form Login
            .httpBasic(httpBasic -> httpBasic.disable()) // Tắt Basic Authentication
            .oauth2Login(Customizer.withDefaults()); // Dùng OAuth2 xử lý
        return http.build();
    }
}
```
