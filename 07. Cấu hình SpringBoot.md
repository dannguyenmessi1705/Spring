# Bắt đầu dự án SpringBoot
## 1. Sử dụng Spring Initializr
**Spring Initializr** là một công cụ giúp chúng ta tạo ra một dự án SpringBoot một cách nhanh chóng và dễ dàng.

Để sử dụng **Spring Initializr**, chúng ta truy cập vào trang chủ của Spring Initializr tại [https://start.spring.io/](https://start.spring.io/).

Sau đó, để tạo một dự án SpringBoot, chúng ta thực hiện các bước sau:
1. Chọn **Project** là **Maven Project** hoặc **Gradle Project**.
2. Chọn **Language** là **Java** hoặc **Kotlin** hoặc **Groovy**.
3. Chọn **Spring Boot** version.
4. Chọn **Project Metadata**:
    - **Group**: Group ID của dự án.
    - **Artifact**: Artifact ID của dự án.
    - **Name**: Tên dự án.
    - **Description**: Mô tả dự án.
    - **Package Name**: Package name của dự án.
    - **Packaging**: Jar hoặc War.
    - **Java**: Java version.
5. Chọn **Dependencies**:
    - **Spring Boot DevTools**: Cung cấp một số công cụ hỗ trợ phát triển dự án SpringBoot, reload server khi có thay đổi mà không cần restart server, trừ khi thay đổi file `pom.xml`.
    - **Spring Web**: Hỗ trợ phát triển ứng dụng Web.
    - **Thymeleaf**: Template Engine.
    - **Spring Data JPA**: Hỗ trợ phát triển ứng dụng sử dụng JPA, một loại giao tiếp với cơ sở dữ liệu.
    - **Spring Data JDBC**: Hỗ trợ phát triển ứng dụng sử dụng JDBC, một loại giao tiếp với cơ sở dữ liệu.
    - **H2 Database**: Cơ sở dữ liệu H2, một cơ sở dữ liệu in-memory.

Sau khi chọn xong, chúng ta nhấn vào nút **Generate** để tải về dự án SpringBoot.

## 2. Import dự án vào IDE
Sau khi tải về dự án SpringBoot, chúng ta giải nén dự án và import vào IDE.

Với IntelliJ IDEA, chúng ta chọn **File** -> **Open...** và chọn thư mục dự án vừa giải nén.

Với Eclipse, chúng ta chọn **File** -> **Import...** -> **Existing Maven Projects** và chọn thư mục dự án vừa giải nén.

## 3. Chạy ứng dụng SpringBoot
Để chạy ứng dụng SpringBoot, chúng ta chạy file **DemoApplication.java**.

## 4. Tạo API đơn giản
Để tạo một API đơn giản, chúng ta tạo một Controller và một API.

Sử dụng Annotation `@RestController` để đánh dấu một class là một Controller.

Sử dung Annotation `@RequestMapping` để đánh dấu một phương thức là một API (Bao gồm cả phương thức GET, POST, PUT, DELETE).

Sử dụng Annotation `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping` để đánh dấu một phương thức là một API (Tương ứng với phương thức GET, POST, PUT, DELETE).

Ví dụ:
```java
package com.example.demo;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello World!";
    }
}
```

Trong ví dụ trên, chúng ta đã tạo một API `/hello` trả về chuỗi "Hello World!".

## 5. Cấu hình môi trường cho ứng dụng SpringBoot
Trong SpringBoot, chúng ta có thể cấu hình các profiles cho ứng dụng SpringBoot thông qua file **application.properties** 
hoặc **application.yml**.

> Lưu ý: Việc cấu hình tên cho projects rất quan trọng để tránh trùng lặp với các projects khác nhất là trong Microservices: `spring.application.name`.

### 5.1. Cấu hình các profiles cho ứng dụng SpringBoot
Thông thường, khi phát triển ứng dụng SpringBoot, chúng ta cần cấu hình các profiles cho ứng dụng SpringBoot như: `dev`, `prod`, `test`.

Để cấu hình các profiles cho ứng dụng SpringBoot, chúng ta tạo các file cấu hình với tên là `application-{profile}.properties` hoặc `application-{profile}.yml`.

Các file cấu hình này sẽ được load tương ứng với profile mà chúng ta cấu hình trong file **application.properties** hoặc **application.yml**. Nếu có trùng giá trị với file gốc, giá trị trong file cấu hình profile sẽ được sử dụng.

Ví dụ:
>`application-dev.properties`: Cấu hình cho môi trường `dev`.
```properties
# Logging
logging.level.org.springframework=trace 
```

>`application-prod.properties`: Cấu hình cho môi trường `prod`.
```properties
# Logging
logging.level.org.springframework=info
```

>`application.properties`: Cấu hình mặc định.
```properties
# Logging
logging.level.org.springframework=debug
# Chọn profile, giá trị chính là tên sau dấu '-' trong tên file cấu hình
spring.profiles.active=dev 
```

### 5.2. Đọc biến môi trường từ file `application.properties` bằng `@ConfigurationProperties` để cấu hình ứng dụng SpringBoot
Trong SpringBoot, chúng ta có thể cấu hình các thông số cho ứng dụng SpringBoot thông qua Annotation `@ConfigurationProperties`. Nó sẽ lấy các giá trị từ file cấu hình `application.properties` hoặc `application.yml`.

`@ConfigurationProperties` với `prefix` sẽ lấy các giá trị từ file cấu hình với prefix tương ứng. Sử dụng annotation này giúp chúng ta có thể lấy được nhiều thông số từ file cấu hình một cách dễ dàng và không bị mã hóa cứng trong code.

Ví dụ:
>`application.properties`
```properties
# Cấu hình thông số cho ứng dụng
app.name=Demo
app.version=1.0
```

>`AppProperties.java`
```java
package com.example.demo;

import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

@Component
@ConfigurationProperties(prefix = "app") // Lấy thông số từ file cấu hình application.properties với prefix là 'app'
public class AppProperties {
    private String name; // Lấy thông số 'app.name' sẽ tự động gán vào biến name
    private String version; // Lấy thông số 'app.version' sẽ tự động gán vào biến version
    
    // Getter và Setter (Bắt buộc phải có để SpringBoot có thể inject giá trị vào biến)
}
```
Trong ví dụ trên, chúng ta đã tạo một class `AppProperties` để lấy thông số `app.name` và `app.version` từ file cấu hình `application.properties`. Lưu ý phải thêm Annotation `@Component` để SpringBoot có thể quản lý Bean này.

### 5.3. Đọc biến môi trường từ file `application.properties` bằng `@Value` để cấu hình ứng dụng SpringBoot
Trong SpringBoot, chúng ta có thể cấu hình các thông số cho ứng dụng SpringBoot thông qua Annotation `@Value`. Nó sẽ lấy các giá trị từ file cấu hình `application.properties` hoặc `application.yml`.

`@Value` sẽ lấy giá trị từ file cấu hình với key tương ứng. Sử dụng annotation này giúp chúng ta có thể lấy được một thông số từ file cấu hình một cách dễ dàng.

Ví dụ:
>Serivce.java
```java
package com.example.demo;

import org.springframework.beans.factory.annotation.Value;

public class Service {
    @Value("${app.name}") // Lấy thông số 'app.name' từ file cấu hình application.properties và gán vào biến name
    private String name;
    
    @Value("${app.version}") // Lấy thông số 'app.version' từ file cấu hình application.properties và gán vào biến version
    private String version;
}
```
Trong ví dụ trên, chúng ta đã tạo một class `Service` để lấy thông số `app.name` và `app.version` từ file cấu hình `application.properties`.

### 5.4. Đọc biến môi trường từ file `application.properties` bằng `Environment` để cấu hình ứng dụng SpringBoot
Trong SpringBoot, chúng ta có thể cấu hình các thông số cho ứng dụng SpringBoot thông qua Interface `Environment`. Nó sẽ lấy các giá trị từ file cấu hình `application.properties` hoặc `application.yml`.

`Environment` sẽ lấy giá trị từ file cấu hình với key tương ứng. Sử dụng Interface này giúp chúng ta có thể lấy được một thông số từ file cấu hình một cách dễ dàng.

Ngoài ra, `Environment` là một Bean của SpringBoot nên chúng ta phải Inject nó vào class cần sử dụng thông qua Annotation `@Autowired` hoặc thông qua `Constructor`.

`Environment` còn được sử dụng để đọc biến môi trường ở môi trường OS.

Ví dụ:
>Serivce.java
```java
package com.example.demo;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.env.Environment;

public class Service {
    @Autowired // Cần phải Inject Environment vào Service để sử dụng
    private Environment env;
    
    public void print() {
        System.out.println(env.getProperty("app.name")); // Lấy thông số 'app.name' từ file cấu hình application.properties
        System.out.println(env.getProperty("app.version")); // Lấy thông số 'app.version' từ file cấu hình application.properties
    }
}
```
Trong ví dụ trên, chúng ta đã tạo một class `Service` để lấy thông số `app.name` và `app.version` từ file cấu hình `application.properties`.

## 6. Sử dụng Actuator trong ứng dụng SpringBoot
Trong SpringBoot, chúng ta có thể sử dụng Actuator để quản lý ứng dụng SpringBoot.

Để sử dụng Actuator, chúng ta thêm thư viện `spring-boot-starter-actuator` vào file **pom.xml**.

Sau khi thêm thư viện, chúng ta có thể truy cập vào các API của Actuator thông qua đường dẫn `/actuator`.

Để kiểm tra toàn bộ thông tin ứng dụng, chúng ta sửa cấu hình trong file **application.properties** hoặc **application.yml**:
```properties
management.endpoints.web.exposure.include=* # Cho phép truy cập tất cả các API của Actuator
management.endpoints.web.exposure.include=health,metrics # Cho phép truy cập API health và metrics của Actuator (nên sử dụng cấu hình này tránh lỗi bảo mật)
```
Các API của Actuator:
- `/actuator/health`: Kiểm tra trạng thái của ứng dụng.
- `/actuator/info`: Hiển thị thông tin ứng dụng.
- `/actuator/metrics`: Hiển thị các metrics của ứng dụng.
- `/actuator/beans`: Hiển thị các Bean của ứng dụng.
- `/actuator/env`: Hiển thị các thông số môi trường của ứng dụng.
- `/actuator/loggers`: Hiển thị các loggers của ứng dụng.
- `/actuator/mappings`: Hiển thị các mappings của ứng dụng.
- `/actuator/trace`: Hiển thị các trace của ứng dụng.


## 7. Deploy ứng dụng SpringBoot
Để deploy ứng dụng SpringBoot, chúng ta có thể thực hiện các bước sau:
1. Build ứng dụng SpringBoot bằng lệnh Maven: `mvn clean install`.
2. Sau khi build xong, chúng ta sẽ có file `tenProject.jar` trong thư mục `target`.
3. Chạy ứng dụng SpringBoot bằng lệnh: `java -jar target/tenProject.jar`.
    - Nếu muốn chạy ứng dụng SpringBoot với một cấu hình khác thủ công, chúng ta thêm tiền tố cấu hình vào sau `--` đặt ở cuối lệnh. Ví dụ: `java -jar target/tenProject.jar --spring.profiles.active=prod`. (Program arguments: Ưu tiên cao nhất)
    - Hoặc có thể đê sau `-D` để cấu hình thông số khác. Ví dụ: `java -Dserver.port=8080 -jar target/tenProject.jar`. (VM arguments: Ưu tiên thấp hơn)
    - Hoặc có thể dùng biến môi trường để cấu hình, với quy tắc `viết hoa` và `thay dấu '.' bằng '_'` các biến cách nhau bởi dấu `;` (Environment arguments: Ưu tiên thấp nhất). Ví dụ:
        + Windows: `env:SPRING_PROFILES_ACTIVE="prod";java -jar target/tenProject.jar`.
        + Linux & MacOS: `SPRING_PROFILES_ACTIVE="prod" java -jar target/tenProject.jar`.


## 8. Các thư viện quan trọng trong SpringBoot (file pom.xml)
Trong file **pom.xml**, chúng ta có thể thêm các thư viện quan trọng sau:
- **Spring Boot Starter Web**: Thư viện hỗ trợ phát triển ứng dụng Web.
- **Spring Boot DevTools**: Thư viện hỗ trợ phát triển ứng dụng SpringBoot, reload server khi có thay đổi mà không cần restart server, trừ khi thay đổi file `pom.xml`.
- **Spring Boot Starter Actuator**: Thư viện hỗ trợ quản lý ứng dụng SpringBoot bao gồm: thông tin ứng dụng, thông tin về các Bean, thông tin về các request, thông tin về các lỗi, ...
- **Spring Boot Starter Test**: Thư viện hỗ trợ việc test ứng dụng SpringBoot.
- **Spring Boot Starter Data JPA**: Thư viện hỗ trợ giao tiếp với cơ sở dữ liệu sử dụng JPA.
- **Spring Boot Stảter Data JDBC**: Thư viện hỗ trợ giao tiếp với cơ sở dữ liệu sử dụng JDBC.
- **Spring Boot Starter Security**: Thư viện hỗ trợ bảo mật ứng dụng SpringBoot.